"use strict";(self.webpackChunkreact_native_reanimated_docs=self.webpackChunkreact_native_reanimated_docs||[]).push([[4135],{96909:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>D,contentTitle:()=>w,default:()=>x,frontMatter:()=>g,metadata:()=>A,toc:()=>_});var a=n(83117),r=n(67294),i=n(3905),o=n(67177),l=n(28033),s=n(10758),u=n(56389),c=n(35842),d=n(347),m=n(6328),p=n(49638);const f={code:'function anonymous(){const{scale}=this._closure;return scale.value*2+"rad";}',location:"/home/runner/work/react-native-reanimated/react-native-reanimated/docs/src/examples/DerivedValue.jsx"},v={code:"function anonymous(){const{scale}=this._closure;return{transform:[{scale:scale.value}]};}",location:"/home/runner/work/react-native-reanimated/react-native-reanimated/docs/src/examples/DerivedValue.jsx"},h={code:"function anonymous(){const{rotate}=this._closure;return{transform:[{rotate:rotate.value}]};}",location:"/home/runner/work/react-native-reanimated/react-native-reanimated/docs/src/examples/DerivedValue.jsx"};function k(){const e=(0,s.y)(1),t=(0,u.o)(function(){const t=function(){return 2*e.value+"rad"};return t._closure={scale:e},t.__initData=f,t.__workletHash=9879320280258,t}()),n=(0,c.l)(function(){const t=()=>({transform:[{scale:e.value}]});return t._closure={scale:e},t.__initData=v,t.__workletHash=4122753321172,t}()),a=(0,c.l)(function(){const e=()=>({transform:[{rotate:t.value}]});return e._closure={rotate:t},e.__initData=h,e.__workletHash=913041158741,e}());return r.useEffect((()=>{e.value=(0,d.D)((0,m.j)(2*e.value,{duration:1e3}),-1,!0)}),[]),r.createElement(o.Z,{style:y.container},r.createElement(p.Z,{style:[y.ball,n]}),r.createElement(p.Z,{style:[y.box,a]}))}const y=l.Z.create({container:{flex:1,alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"row"},ball:{height:50,width:50,backgroundColor:"#b58df1",borderRadius:50,marginRight:80},box:{height:100,width:100,backgroundColor:"#b58df1",borderRadius:15}}),b="import React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport Animated, {\n  useSharedValue,\n  useAnimatedStyle,\n  withTiming,\n  withRepeat,\n  useDerivedValue,\n} from 'react-native-reanimated';\n\nexport default function App() {\n  const scale = useSharedValue(1);\n\n  // highlight-start\n  const rotate = useDerivedValue(() => {\n    return `${scale.value * 2}rad`;\n  });\n  // highlight-end\n\n  const scaleStyles = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const rotateStyles = useAnimatedStyle(() => ({\n    transform: [{ rotate: rotate.value }],\n  }));\n\n  React.useEffect(() => {\n    scale.value = withRepeat(\n      withTiming(scale.value * 2, { duration: 1000 }),\n      -1,\n      true\n    );\n  }, []);\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.ball, scaleStyles]} />\n      <Animated.View style={[styles.box, rotateStyles]} />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '100%',\n    flexDirection: 'row',\n  },\n  ball: {\n    height: 50,\n    width: 50,\n    backgroundColor: '#b58df1',\n    borderRadius: 50,\n    marginRight: 80,\n  },\n  box: {\n    height: 100,\n    width: 100,\n    backgroundColor: '#b58df1',\n    borderRadius: 15,\n  },\n});\n",g={sidebar_position:5},w="useDerivedValue",A={unversionedId:"core/useDerivedValue",id:"core/useDerivedValue",title:"useDerivedValue",description:"useDerivedValue lets you create new shared values based on existing ones while keeping them reactive.",source:"@site/docs/core/useDerivedValue.mdx",sourceDirName:"core",slug:"/core/useDerivedValue",permalink:"/react-native-reanimated/docs/core/useDerivedValue",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/core/useDerivedValue.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"useAnimatedRef",permalink:"/react-native-reanimated/docs/core/useAnimatedRef"},next:{title:"createAnimatedComponent",permalink:"/react-native-reanimated/docs/core/createAnimatedComponent"}},D={},_=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>updater</code>",id:"updater",level:4},{value:"<code>dependencies</code> <Optional/>",id:"dependencies-",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],V=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},R=V("Optional"),N=V("InteractiveExample"),S={toc:_},j="wrapper";function x(e){let{components:t,...n}=e;return(0,i.kt)(j,(0,a.Z)({},S,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"usederivedvalue"},"useDerivedValue"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useDerivedValue")," lets you create new ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#shared-value"},"shared values")," based on existing ones while keeping them reactive."),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"import { useDerivedValue } from 'react-native-reanimated';\n\nfunction App() {\n  const derivedValue = useDerivedValue(() => {\n    return sv.value * 50;\n  });\n}\n")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Type definitions"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type SharedValue<T> = { value: T };\ntype DerivedValue<T> = Readonly<SharedValue<T>>;\n\nfunction useDerivedValue<T>(\n  updater: () => T,\n  dependencies?: DependencyList\n): DerivedValue<T>;\n"))),(0,i.kt)("h3",{id:"arguments"},"Arguments"),(0,i.kt)("h4",{id:"updater"},(0,i.kt)("inlineCode",{parentName:"h4"},"updater")),(0,i.kt)("p",null,"A function that should return a value constructed of shared values, React state or any other JavaScript value. This function is called whenever at least one of the shared values or state used in the function body changes."),(0,i.kt)("h4",{id:"dependencies-"},(0,i.kt)("inlineCode",{parentName:"h4"},"dependencies")," ",(0,i.kt)(R,{mdxType:"Optional"})),(0,i.kt)("p",null,"An optional array of dependencies."),(0,i.kt)("p",null,"Only relevant when using Reanimated ",(0,i.kt)("a",{parentName:"p",href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/web-support#web-without-a-babel-plugin"},"without the Babel plugin on the Web"),"."),(0,i.kt)("h3",{id:"returns"},"Returns"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"useDerivedValue")," returns a new readonly ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#shared-value"},"shared value")," based on a value returned from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/core/useDerivedValue#updater"},(0,i.kt)("inlineCode",{parentName:"a"},"updater"))," function."),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)(N,{src:b,component:(0,i.kt)(k,{mdxType:"DerivedValue"}),mdxType:"InteractiveExample"}),(0,i.kt)("h2",{id:"remarks"},"Remarks"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The callback passed to the first argument is automatically ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#to-workletize"},"workletized")," and ran on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"You can also use ",(0,i.kt)("inlineCode",{parentName:"p"},"useDerivedValue")," without returning a value in the ",(0,i.kt)("inlineCode",{parentName:"p"},"updater")," function to react to a change of a shared value. If you need to access the previous value stored in a shared value use ",(0,i.kt)("a",{parentName:"p",href:"/docs/advanced/useAnimatedReaction"},(0,i.kt)("inlineCode",{parentName:"a"},"useAnimatedReaction"))," instead."))),(0,i.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,i.kt)("div",{className:"compatibility"},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Android"),(0,i.kt)("th",{parentName:"tr",align:null},"iOS"),(0,i.kt)("th",{parentName:"tr",align:null},"Web"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:null},"\u2705"))))))}x.isMDXComponent=!0},347:(e,t,n)=>{n.d(t,{D:()=>r});var a=n(81774);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return(0,a.oF)(e,(()=>{const a="function"==typeof e?e():e;return{isHigherOrder:!0,onFrame:function(e,r){const i=a.onFrame(a,r);if(e.current=a.current,i){if(e.reps+=1,a.callback&&a.callback(!0,e.current),t>0&&e.reps>=t)return!0;const i=n?a.current:e.startValue;return n&&(a.toValue=e.startValue,e.startValue=i),a.onStart(a,i,r,a.previousAnimation),!1}return!1},onStart:function(e,t,n,r){e.startValue=t,e.reps=0,a.onStart(a,t,n,r)},reps:0,current:a.current,callback:e=>{r&&r(e),!e&&a.callback&&a.callback(!1)},startValue:0}}))}},49638:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67177);const r=(0,n(88664).Z)(a.Z)},35842:(e,t,n)=>{n.d(t,{l:()=>h});var a=n(67294),r=n(84831),i=n(97604),o=n(49402),l=n(81774),s=n(4463),u=n(10758),c=n(40093),d=n(41956),m=n(83442);function p(e,t,n,a){if(Array.isArray(t)&&t.forEach(((t,r)=>{p(e,t,n&&n[r],a&&a[r])})),"object"==typeof t&&t.onFrame){const r=t;let i=r.current;void 0!==a&&("object"==typeof a?void 0!==a.value?i=a.value:void 0!==a.onFrame&&(void 0!==(null==n?void 0:n.current)?i=n.current:void 0!==(null==a?void 0:a.current)&&(i=a.current)):i=a),r.callStart=e=>{r.onStart(r,i,e,n)},r.callStart(e),r.callStart=null}else"object"==typeof t&&Object.keys(t).forEach((r=>p(e,t[r],n&&n[r],a&&a[r])))}function f(e,t,n,a,r){if(!r.value)return!0;if(Array.isArray(e)){a[n]=[];let i=!0;return e.forEach(((e,o)=>{f(e,t,o,a[n],r)||(i=!1)})),i}if("object"==typeof e&&e.onFrame){let r=!0;return e.finished||(e.callStart&&(e.callStart(t),e.callStart=null),r=e.onFrame(e,t),e.timestamp=t,r&&(e.finished=!0,e.callback&&e.callback(!0))),a[n]=e.current,r}if("object"==typeof e){a[n]={};let i=!0;return Object.keys(e).forEach((o=>{f(e[o],t,o,a[n],r)||(i=!1)})),i}return a[n]=e,!0}function v(e,t){if(Array.isArray(e))for(const n of e)v(n,t);else if("object"==typeof e&&void 0===e.value)for(const n of Object.keys(e))v(e[n],n);else if(void 0!==t&&"object"==typeof e&&void 0!==e.value)throw new Error(`invalid value passed to \`${t}\`, maybe you forgot to use \`.value\`?`)}function h(e,t,h){const k=(0,d.S)(),y=(0,a.useRef)();let b=Object.values(e._closure??{});var g;(0,m.Wr)()&&(!b.length&&null!==(g=t)&&void 0!==g&&g.length&&(b=t));const w=h?Array.isArray(h)?h:[h]:[],A=h?(0,c.Nq)(w):null,D=(0,u.y)(!0),_=(0,a.useRef)({});if(t?t.push(e.__workletHash):t=[...b,e.__workletHash],A&&t.push(A),!y.current){const t=(0,l.AX)(e);(0,c.Dl)(t),y.current={initial:{value:t,updater:e},remoteState:(0,r.I1)({last:t,animations:{},isAnimationCancelled:!1,isAnimationRunning:!1}),viewDescriptors:(0,d.G)()}}const{initial:V,remoteState:R,viewDescriptors:N}=y.current,S=N.sharableViewDescriptors,j=s.Z.native?void 0:k;return t.push(S),(0,a.useEffect)((()=>{let t,a=e;h&&(a=()=>{const t=e();return w.forEach((e=>{e(t)})),t}),t=(0,m.V5)()?()=>{!function(e,t,a,r,i,l){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];const u=a.animations??{},d=t()??{},m=a.last;let v,h=!1;Object.keys(u).forEach((e=>{const t=d[e];(0,c.mE)(t)||delete u[e]})),Object.keys(d).forEach((e=>{const t=d[e];(0,c.mE)(t)&&(v=n.g.__frameTimestamp||performance.now(),p(v,t,u[e],m[e]),u[e]=t,h=!0)})),h?(a.animations=u,a.isAnimationRunning||(a.isAnimationCancelled=!1,a.isAnimationRunning=!0,function t(n){const{animations:u,last:c,isAnimationCancelled:d}=a;if(d)return void(a.isAnimationRunning=!1);const m={};let p=!0;Object.keys(u).forEach((e=>{f(u[e],n,e,m,i)?(c[e]=m[e],delete u[e]):p=!1})),Object.keys(m).length&&(0,o.RH)(e,m,r,l,s),p?a.isAnimationRunning=!1:requestAnimationFrame(t)}(v))):(a.isAnimationCancelled=!0,a.animations=[]),a.last=d,(0,c.wU)(m,d)||(0,o.RH)(e,d,r,l,s)}(S,e,R,j,D,_,w)}:()=>{!function(e,t,a,r,i){const l=a.animations??{},s=t()??{},u=a.last,d={};let m,v=!1,h=!1;for(const o in s){const e=s[o];(0,c.mE)(e)?(m=n.g.__frameTimestamp||performance.now(),p(m,e,l[o],u[o]),l[o]=e,v=!0):(h=!0,d[o]=e,delete l[o])}if(v){const t=n=>{const{animations:l,last:s,isAnimationCancelled:u}=a;if(u)return void(a.isAnimationRunning=!1);const c={};let d=!0;for(const e in l)f(l[e],n,e,c,i)?(s[e]=c[e],delete l[e]):d=!1;c&&(0,o.ZP)(e,c,r),d?a.isAnimationRunning=!1:requestAnimationFrame(t)};a.animations=l,a.isAnimationRunning||(a.isAnimationCancelled=!1,a.isAnimationRunning=!0,t(m)),h&&(0,o.ZP)(e,d,r)}else a.isAnimationCancelled=!0,a.animations=[],(0,c.wU)(u,s)||(0,o.ZP)(e,s,r);a.last=s}(S,a,R,j,D)};const l=(0,r.Rn)(t,b);return()=>{(0,i.BV)(l)}}),t),(0,a.useEffect)((()=>(D.value=!0,()=>{D.value=!1})),[]),v(V.value),{}.JEST_WORKER_ID?{viewDescriptors:N,initial:V,viewsRef:k,animatedStyle:_}:{viewDescriptors:N,initial:V,viewsRef:k}}},56389:(e,t,n)=>{n.d(t,{o:()=>s});var a=n(67294),r=n(81774),i=n(84831),o=n(97604),l=n(83442);function s(e,t){const n=(0,a.useRef)(null);let s=Object.values(e._closure??{});var u;(0,l.Wr)()&&(!s.length&&null!==(u=t)&&void 0!==u&&u.length&&(s=t));void 0===t?t=[...s,e.__workletHash]:t.push(e.__workletHash),null===n.current&&(n.current=(0,i.vG)((0,r.AX)(e)));const c=n.current;return(0,a.useEffect)((()=>{const t=(0,i.Rn)((()=>{c.value=e()}),s,[c]);return()=>{(0,o.BV)(t)}}),t),(0,a.useEffect)((()=>()=>{n.current=null}),[]),c}},40093:(e,t,n)=>{n.d(t,{Ak:()=>s,Dl:()=>m,Nq:()=>u,mE:()=>c,wU:()=>d,zX:()=>l});var a=n(67294),r=n(84831),i=n(83442),o=n(18452);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=(0,a.useRef)(null);return null===r.current?r.current=new o.Z(e,t):n&&r.current.updateWorklet(e),r}function s(e,t){const n=(0,a.useRef)(null);null===n.current&&(n.current={context:(0,r.I1)({}),savedDependencies:[]}),(0,a.useEffect)((()=>()=>{n.current=null}),[]);const{context:o,savedDependencies:l}=n.current;t=function(e,t){const n=Object.values(t).filter((e=>void 0!==e));e?e.push(u(n)):e=n.map((e=>({workletHash:e.__workletHash,closure:e._closure})));return e}(t,e);const s=!function(e,t){function n(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}const a="function"==typeof Object.is?Object.is:n;function r(e,t){if(!e||!t||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!a(e[n],t[n]))return!1;return!0}return r(e,t)}(t,l);n.current.savedDependencies=t;return{context:o,doDependenciesDiffer:s,useWeb:(0,i.$L)()||(0,i.V5)()}}function u(e){return Object.values(e).reduce(((e,t)=>e+t.__workletHash.toString()),"")}function c(e){return Array.isArray(e)?e.some(c):"object"==typeof e&&(void 0!==e.onFrame||Object.values(e).some(c))}function d(e,t){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(let r=0;r<n.length;r++)if(e[n[r]]!==t[n[r]])return!1;return!0}const m=e=>{if("object"!=typeof e)throw new Error(`useAnimatedStyle has to return an object, found ${typeof e} instead`);if(Array.isArray(e))throw new Error("useAnimatedStyle has to return an object and cannot return static styles combined with dynamic ones. Please do merging where a component receives props.")}}}]);